<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>行程計算機：台灣落地課安排</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;800&display=swap" rel="stylesheet">
<style>
  :root{
    --bg:#f7f8fb;
    --paper:#ffffff;
    --ink:#1b2430;
    --muted:#6b7280;
    --border:#e5e7eb;
    --accent:#2563eb;
    --chip:#f1f5f9;
    --shadow: 0 6px 24px rgba(16,24,40,.06);
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:'Noto Sans TC',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;overflow-x:hidden;width:100%}
  a{color:var(--accent);text-decoration:none}
  .wrap{max-width:1200px;margin:28px auto;padding:0 20px 56px;width:100%;overflow-x:hidden;max-width:100vw}
  header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
  header h1{font-size:clamp(20px, 4vw, 26px);margin:0;font-weight:800;letter-spacing:.2px}
  .tag{font-size:12px;background:linear-gradient(90deg,var(--accent),#60a5fa);color:#fff;padding:7px 12px;border-radius:999px;font-weight:700;box-shadow:var(--shadow)}
  .layout{display:grid;grid-template-columns:1.4fr .9fr;gap:20px}
  .stack{display:grid;gap:16px}
  .card{background:var(--paper);border:1px solid var(--border);border-radius:16px;padding:18px;box-shadow:var(--shadow);overflow-x:hidden;max-width:100%}
  .title{font-weight:800;font-size:clamp(14px, 3vw, 15px);margin:0 0 10px 0;color:#0f172a;letter-spacing:.3px}
  dl.kv{display:grid;grid-template-columns:140px 1fr;row-gap:12px;margin:0}
  dl.kv dt{color:var(--muted)}
  dl.kv dd{margin:0}
  /* input styles */
  .input-group{display:flex;align-items:center;gap:8px}
  .input-field{flex:1;padding:8px 12px;border:1px solid var(--border);border-radius:8px;font-size:14px;background:var(--paper);color:var(--ink);transition:border-color 0.2s}
  .input-field:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 3px rgba(37,99,235,0.1)}
  .input-field:invalid{border-color:#ef4444}
  .input-label{font-size:12px;color:var(--muted);margin-bottom:4px;display:block}
  .unit{color:var(--muted);font-size:12px;white-space:nowrap}
  .settings-grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  .setting-item{display:flex;flex-direction:column}
  /* table */
  .table-container{overflow:hidden;margin:0;padding:0;max-width:100%}
  table{width:100%;border-collapse:separate;border-spacing:0;font-size:clamp(13px, 2.5vw, 14px);max-width:100%;table-layout:fixed}
  table th:nth-child(1), table td:nth-child(1){width:20%}
  table th:nth-child(2), table td:nth-child(2){width:50%}
  table th:nth-child(3), table td:nth-child(3){width:30%}
  thead th{position:sticky;top:0;background:#fafafa;border-bottom:1px solid var(--border);padding:clamp(8px, 1.5vw, 10px);text-align:left;font-weight:600;word-break:break-word}
  tbody td{padding:clamp(8px, 1.5vw, 10px);border-bottom:1px dashed var(--border);line-height:1.4;word-break:break-word;max-width:0}
  tbody tr:hover{background:#fafcff}
  .right{text-align:right}
  .money{font-variant-numeric:tabular-nums}
  .total-row td{border-bottom:none;border-top:2px solid var(--ink);font-weight:800}
  .row{display:flex;gap:8px;flex-wrap:wrap}
  /* sticky summary aside */
  aside.summary{position:sticky;top:20px;display:grid;gap:16px;height:fit-content}
  .kpi{display:flex;align-items:baseline;gap:10px}
  .kpi .num{font-weight:800;font-size:clamp(22px, 4vw, 28px);letter-spacing:.4px}
  .kpi .lbl{color:var(--muted);font-size:clamp(12px, 2.5vw, 14px)}
  .kpi.ok{color:var(--accent)}
  .div{height:1px;background:var(--border);margin:4px 0}
  /* timeline */
  .timeline{position:relative;margin:0;padding:8px 0 0 0;list-style:none}
  .timeline:before{content:"";position:absolute;left:14px;top:0;bottom:0;width:2px;background:var(--border)}
  .timeline li{display:grid;grid-template-columns:28px 1fr;gap:12px;padding:clamp(10px, 2vw, 12px) 0}
  .dot{width:12px;height:12px;border-radius:50%;margin-top:6px;background:var(--accent);position:relative;z-index:1}
  .pill{display:inline-block;padding:4px 10px;border-radius:999px;background:#eef2ff;border:1px solid #dbeafe;color:#1e3a8a;font-size:clamp(11px, 2vw, 12px);margin:2px 0}
  /* chart */
  .legend{display:grid;grid-template-columns:1fr;gap:8px;margin-top:10px;width:100%;overflow:hidden}
  .legend .item{display:flex;align-items:center;gap:8px;font-size:13px;color:#0f172a;width:100%;min-width:0}
  .legend .item span:last-child{flex:1;min-width:0;word-break:break-word;overflow:hidden}
  .swatch{width:12px;height:12px;border-radius:3px;display:inline-block;flex-shrink:0}
  @media (max-width: 980px){
    .layout{grid-template-columns:1fr;gap:16px}
    aside.summary{position:relative;top:auto}
    thead th{position:static}
    .wrap{padding:0 16px 40px;margin:20px auto}
    .card{padding:16px;border-radius:12px;overflow-x:hidden;max-width:100%}
    .stack{gap:14px}
    header{margin-bottom:16px}
    dl.kv{grid-template-columns:100px 1fr;row-gap:10px}
    .legend .item{font-size:clamp(12px, 2.5vw, 13px)}
    .table-container{margin:0;padding:0;overflow:hidden}
    .settings-grid{grid-template-columns:1fr;gap:12px}
  }
  
  @media (max-width: 480px){
    .wrap{padding:0 12px 32px;margin:16px auto;max-width:100vw;overflow-x:hidden}
    .card{padding:14px;border-radius:10px;overflow-x:hidden;max-width:100%}
    .stack{gap:12px}
    header{margin-bottom:14px}
    dl.kv{grid-template-columns:80px 1fr;row-gap:8px}
    .timeline li{grid-template-columns:24px 1fr;gap:10px}
    .timeline:before{left:12px}
    .dot{width:10px;height:10px;margin-top:4px;position:relative;z-index:1}
    .pill{padding:3px 8px;font-size:10px;word-break:keep-all;white-space:nowrap}
    .kpi{gap:8px}
    .kpi .num{font-size:clamp(18px, 5vw, 22px)}
    .kpi .lbl{font-size:clamp(11px, 2.5vw, 12px)}
    .table-container{margin:0;padding:0;overflow:hidden}
    table th:nth-child(1), table td:nth-child(1){width:25%}
    table th:nth-child(2), table td:nth-child(2){width:45%}
    table th:nth-child(3), table td:nth-child(3){width:30%}
    .settings-grid{grid-template-columns:1fr;gap:10px}
    .input-field{font-size:14px;padding:6px 10px}
    .legend{width:100%;overflow:hidden;max-width:100%}
    .legend .item{font-size:clamp(10px, 2.5vw, 11px);flex-wrap:nowrap;overflow:hidden;width:100%;max-width:100%}
    .legend .item span:last-child{flex:1;min-width:0;word-break:break-word;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;max-width:calc(100% - 20px)}
    canvas{max-width:min(100%, 250px) !important;aspect-ratio:1/1 !important;height:auto !important}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>台灣落地課安排</h1>
    </header>

    <div class="layout">
      <!-- 左：主要內容 -->
      <div class="stack">
        <!-- 基本設定 -->
        <section class="card">
          <h2 class="title">基本設定</h2>
          <div class="settings-grid">
            <div class="setting-item">
              <label class="input-label">來訪人數</label>
              <div class="input-group">
                <input type="number" class="input-field" id="people" value="3" min="1" max="20" placeholder="來訪人數">
                <span class="unit">人</span>
              </div>
            </div>
            <div class="setting-item">
              <label class="input-label">行程總天數</label>
              <div class="input-group">
                <input type="number" class="input-field" id="days" value="6" min="1" max="30" placeholder="行程總天數">
                <span class="unit">天</span>
              </div>
            </div>
            <div class="setting-item">
              <label class="input-label">學生人數</label>
              <div class="input-group">
                <input type="number" class="input-field" id="students" value="50" min="1" max="1000" placeholder="學生人數">
                <span class="unit">人</span>
              </div>
            </div>
          </div>
        </section>

        <!-- 費用預估 -->
        <section class="card">
          <h2 class="title">費用預估</h2>
          <div class="table-container">
            <table class="money">
              <thead>
                <tr><th>項目</th><th>說明</th><th class="right">金額 (NTD)</th></tr>
              </thead>
              <tbody>
                <tr><td>機票來回</td><td id="flight-desc">台北 ↔ 深圳｜8,000/人 × 3</td><td class="right" id="flight-cost">24,000</td></tr>
                <tr><td>酒店住宿</td><td id="hotel-desc">台北柯達飯店｜2,500/天 × 2 間 × 5 晚</td><td class="right" id="hotel-cost">25,000</td></tr>
                <tr><td>場地費</td><td id="venue-desc">Spaceco 中山國小｜13,500/天 × 4 天</td><td class="right" id="venue-cost">54,000</td></tr>
                <tr><td>餐食</td><td id="meal-desc">6 天 5 夜｜Day1：只有晚餐｜Day2-5：中餐輕食、晚餐｜Day6：回程餐點</td><td class="right" id="meal-cost">40,000</td></tr>
                <tr><td>交通</td><td id="transport-desc">市內交通與雜支｜1,000/天 × 6 天</td><td class="right" id="transport-cost">6,000</td></tr>
                <tr class="total-row">
                  <td colspan="2">總計</td>
                  <td class="right" id="total-cost">149,000</td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <!-- 行程規劃 -->
        <section class="card">
          <h2 class="title">行程規劃（Timeline）</h2>
          <ul class="timeline" id="timeline-container">
            <!-- 動態生成內容 -->
          </ul>
        </section>
      </div>

      <!-- 右：摘要 / KPI & CHART -->
      <aside class="summary">
        <section class="card">
          <h2 class="title">總花費</h2>
          <div class="kpi"><span class="num" id="summary-total">NT$149,000</span><span class="lbl">總計</span></div>
          <div class="div"></div>
          <div class="kpi" style="color:var(--accent)">
            <span class="num" id="summary-per-person">NT$2,980</span><span class="lbl" id="summary-per-person-label">平均每人（50 人）</span>
          </div>
        </section>

        <section class="card">
          <h2 class="title">費用結構（Chart）</h2>
          <div style="display:flex;justify-content:center;margin-bottom:16px;overflow:hidden;max-width:100%;width:100%">
            <canvas id="pie" width="300" height="300" aria-label="費用比例圓餅圖" style="max-width:100%;height:auto;aspect-ratio:1/1;width:min(100%, 300px);height:min(100%, 300px)"></canvas>
          </div>
          <div id="legend" class="legend"></div>
        </section>
      </aside>
    </div>
  </div>

<script>
  // 動態計算和圖表功能
  (function() {
    // 費用計算參數
    const costParams = {
      flightPerPerson: 8000,
      hotelPerRoomPerNight: 2500,
      maxPeoplePerRoom: 2, // 最多2人一間
      venuePerDay: 13500,
      mealPerDay: 8000, // 餐食費用 8000/天
      transportPerDay: 1000 // 交通費用 1000/天
    };
    
    // 動態數據
    let data = [24000, 25000, 54000, 40000, 6000]; // 6天行程初始數據，會被動態更新
    const labels = ['機票', '住宿', '場地', '餐食', '交通'];
    const colors = ["#3b82f6","#a78bfa","#22c55e","#f59e0b","#ef4444"];
    
    // 計算費用
    function calculateCosts() {
      const people = parseInt(document.getElementById('people').value) || 3;
      const days = parseInt(document.getElementById('days').value) || 6;
      const students = parseInt(document.getElementById('students').value) || 50;
      
      // 計算各項費用
      const flightCost = people * costParams.flightPerPerson;
      // 計算需要的房間數：向上取整
      const requiredRooms = Math.ceil(people / costParams.maxPeoplePerRoom);
      const hotelCost = requiredRooms * costParams.hotelPerRoomPerNight * (days - 1);
      // 場地天數 = 行程天數 - 2
      const venueDays = Math.max(0, days - 2);
      const venueCost = costParams.venuePerDay * venueDays;
      // 餐食費用 = 10000/天 x (n-1) 天
      const mealDays = Math.max(0, days - 1);
      const mealCost = costParams.mealPerDay * mealDays;
      // 交通費用 = 1000/天 x n 天
      const transportCost = costParams.transportPerDay * days;
      
      data = [flightCost, hotelCost, venueCost, mealCost, transportCost];
      
      // 更新表格
      updateTable(people, days, requiredRooms, venueDays, mealDays);
      
      // 更新摘要
      updateSummary(data, students);
      
      // 更新時間軸
      updateTimeline(days);
      
      // 更新圖表
      drawChart();
      
      // 更新圖例
      updateLegend();
    }
    
    // 更新表格
    function updateTable(people, days, requiredRooms, venueDays, mealDays) {
      document.getElementById('flight-desc').textContent = `台北 ↔ 深圳｜${costParams.flightPerPerson.toLocaleString()}/人 × ${people}`;
      document.getElementById('flight-cost').textContent = (people * costParams.flightPerPerson).toLocaleString();
      
      document.getElementById('hotel-desc').textContent = `台北柯達飯店｜${costParams.hotelPerRoomPerNight.toLocaleString()}/天 × ${requiredRooms} 間 × ${days - 1} 晚`;
      document.getElementById('hotel-cost').textContent = (requiredRooms * costParams.hotelPerRoomPerNight * (days - 1)).toLocaleString();
      
      document.getElementById('venue-desc').textContent = `Spaceco 中山國小｜${costParams.venuePerDay.toLocaleString()}/天 × ${venueDays} 天`;
      document.getElementById('venue-cost').textContent = (costParams.venuePerDay * venueDays).toLocaleString();
      
      // 生成餐食說明
      let mealDesc = '';
      if (days === 1) {
        mealDesc = 'Day1：只有晚餐';
      } else if (days === 2) {
        mealDesc = 'Day1：只有晚餐｜Day2：回程餐點';
      } else {
        mealDesc = `Day1：只有晚餐｜Day2-${days-1}：中餐輕食、晚餐｜Day${days}：回程餐點`;
      }
      document.getElementById('meal-desc').textContent = `${days} 天 ${days - 1} 夜｜${mealDesc}`;
      document.getElementById('meal-cost').textContent = (costParams.mealPerDay * mealDays).toLocaleString();
      
      document.getElementById('transport-desc').textContent = `市內交通與雜支｜${costParams.transportPerDay.toLocaleString()}/天 × ${days} 天`;
      document.getElementById('transport-cost').textContent = (costParams.transportPerDay * days).toLocaleString();
      
      const total = data.reduce((a, b) => a + b, 0);
      document.getElementById('total-cost').textContent = total.toLocaleString();
    }
    
    // 更新摘要
    function updateSummary(costs, students) {
      const total = costs.reduce((a, b) => a + b, 0);
      const perPerson = Math.round(total / students);
      
      document.getElementById('summary-total').textContent = `NT$${total.toLocaleString()}`;
      document.getElementById('summary-per-person').textContent = `NT$${perPerson.toLocaleString()}`;
      document.getElementById('summary-per-person-label').textContent = `平均每人（${students} 人）`;
    }
    
    // 更新時間軸
    function updateTimeline(days) {
      const timelineContainer = document.getElementById('timeline-container');
      timelineContainer.innerHTML = '';
      
      for (let i = 1; i <= days; i++) {
        const li = document.createElement('li');
        
        let title, pills;
        
        if (i === 1) {
          // 第一天：落地
          title = `<strong>Day ${i}</strong>｜落地`;
          pills = [
            '<span class="pill">飛機：落地</span>',
            '<span class="pill">酒店：一晚</span>',
            '<span class="pill">教室：x</span>',
            '<span class="pill">餐食：晚餐</span>'
          ];
        } else if (i === days) {
          // 最後一天：回程
          title = `<strong>Day ${i}</strong>｜回程`;
          pills = [
            '<span class="pill">飛機：回程</span>',
            '<span class="pill">酒店：x</span>',
            '<span class="pill">教室：x</span>',
            '<span class="pill">餐食：回程餐點</span>'
          ];
        } else {
          // 中間天數：課程
          title = `<strong>Day ${i}</strong>｜課程`;
          pills = [
            '<span class="pill">飛機：x</span>',
            '<span class="pill">酒店：一晚</span>',
            '<span class="pill">教室：一天</span>',
            '<span class="pill">餐食：中餐輕食、晚餐</span>'
          ];
        }
        
        li.innerHTML = `
          <span class="dot"></span>
          <div>
            <div>${title}</div>
            <div class="row" style="margin-top:6px">
              ${pills.join('')}
            </div>
          </div>
        `;
        
        timelineContainer.appendChild(li);
      }
    }
    
    // 添加事件監聽器
    function addEventListeners() {
      const inputs = ['people', 'days', 'students'];
      inputs.forEach(id => {
        const element = document.getElementById(id);
        element.addEventListener('input', calculateCosts);
        element.addEventListener('change', calculateCosts);
      });
    }
    
    // 初始化
    addEventListeners();
    
    // 初始化時間軸
    const initialDays = parseInt(document.getElementById('days').value) || 6;
    updateTimeline(initialDays);
    
    // Pie chart without external libraries
    const total = data.reduce((a,b)=>a+b,0);

    const canvas = document.getElementById('pie');
    const ctx = canvas.getContext('2d');
    
    // 響應式調整 canvas 尺寸 - 保持正方形
    function resizeCanvas() {
      const container = canvas.parentElement;
      const containerWidth = container.clientWidth;
      const maxSize = Math.min(containerWidth - 32, 300);
      
      // 確保 canvas 始終是正方形
      canvas.width = maxSize;
      canvas.height = maxSize;
      canvas.style.width = maxSize + 'px';
      canvas.style.height = maxSize + 'px';
    }
    
    resizeCanvas();
    window.addEventListener('resize', resizeCanvas);
    
    const cx = canvas.width/2;
    const cy = canvas.height/2;
    const radius = Math.min(cx, cy) - 10;

    function drawChart() {
      // 清除 canvas
      ctx.clearRect(0, 0, canvas.width, canvas.height);
      
      // 由於 canvas 是正方形，中心點和半徑計算更簡單
      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const radius = Math.min(centerX, centerY) - 15; // 留出更多邊距
      
      // 使用當前的動態數據
      const currentTotal = data.reduce((a,b)=>a+b,0);
      
      let startAngle = -Math.PI/2;
      data.forEach((v, i) => {
        const slice = (v/currentTotal) * Math.PI * 2;
        ctx.beginPath();
        ctx.moveTo(centerX, centerY);
        ctx.arc(centerX, centerY, radius, startAngle, startAngle + slice);
        ctx.closePath();
        ctx.fillStyle = colors[i];
        ctx.fill();
        startAngle += slice;
      });

      // Labels - 只在圓餅圖足夠大時顯示
      if (radius > 40) {
        startAngle = -Math.PI/2;
        ctx.fillStyle = "#111827";
        const fontSize = Math.max(8, Math.min(12, radius * 0.12));
        ctx.font = `${fontSize}px 'Noto Sans TC', sans-serif`;
        data.forEach((v,i)=>{
          const mid = startAngle + (v/currentTotal)*Math.PI;
          const tx = centerX + Math.cos(mid) * (radius*0.7);
          const ty = centerY + Math.sin(mid) * (radius*0.7);
          const pct = Math.round(v/currentTotal*100);
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText(pct + "%", tx, ty);
          startAngle += (v/currentTotal)*Math.PI*2;
        });
      }
    }
    
    drawChart();
    
    // 監聽視窗大小變化
    window.addEventListener('resize', () => {
      resizeCanvas();
      drawChart();
    });

    // 更新圖例
    function updateLegend() {
      const legend = document.getElementById('legend');
      legend.innerHTML = ''; // 清除現有內容
      
      const currentTotal = data.reduce((a,b)=>a+b,0);
      labels.forEach((lbl, i) => {
        const item = document.createElement('div');
        item.className = 'item';
        const sw = document.createElement('span');
        sw.className = 'swatch';
        sw.style.background = colors[i];
        const text = document.createElement('span');
        const pct = Math.round(data[i]/currentTotal*100);
        text.textContent = `${lbl}：${data[i].toLocaleString()}（${pct}%）`;
        item.appendChild(sw);
        item.appendChild(text);
        legend.appendChild(item);
      });
    }
    
    // 初始化圖例
    updateLegend();
  })();
</script>
</body>
</html>
